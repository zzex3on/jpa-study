# ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ
   
1. ```Persistence``` í´ë˜ìŠ¤ì—ì„œ ```persistence.xml``` ì„¤ì • ì •ë³´ë¥¼ ì¡°íšŒ
2. ì¡°íšŒëœ ì •ë³´ë¥¼ í†µí•´ ```EntityManagerFactory``` í´ë˜ìŠ¤ ìƒì„±
3. ìƒì„±ëœ ```EntityManagerFactory``` ì—ì„œ í•„ìš”í•  ë•Œë§ˆë‹¤ ```EntityManager``` ë¥¼ ìƒì„±í•¨

### JPA ì£¼ì˜ì‚¬í•­ âœ¨
- EntityManageFactoryëŠ” DB ë‹¹ í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ê°€ ê³µìœ í•¨
- EntityManageëŠ” Thread ê°„ì— ê³µìœ í•˜ì§€ ì•ŠìŒ! (ê¸°ëŠ¥ í•˜ë‚˜ì— ì“°ê³  ë²„ë¦¼, ì¼íšŒìš©ê°™ì€ ëŠë‚Œ?)
- JPAì—ì„œ íŠ¸ëœì­ì…˜ì€ ë§¤ìš° ì¤‘ìš”í•œ ë‹¨ìœ„! (ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” ëª¨ë“  ì‘ì—…ì€ __ë°˜ë“œì‹œ__ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ìˆ˜í–‰ë˜ì–´ì•¼ í•¨)
   - ì†ŒìŠ¤
     ```java
     EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜ ì–»ìŒ
     tx.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘
   
     Member member = new Member();
     member.setId(1L);
     member.setName("HelloA");
     em.persist(member);
     tx.commit();
     ```

  __ê²°ê³¼__
  
  ![image](https://github.com/zzex3on/jpa-study/assets/87990439/2a358922-a439-4933-9d4a-bd265c8b6d5b)
  ** ```persistence.xml```ì˜ ```hibernate.show_sql``` ì™€ ```hibernate.use_sql_comments``` ì†ì„±ì˜ ê°’ì´ ```true``` ì—¬ì„œ ìœ„ì²˜ëŸ¼ ë¡œê·¸ê°€ ë‚¨ê²Œ ë¨

## JPAì—ì„œì˜ CRUD âœ¨
_ìì„¸í•œ ì†ŒìŠ¤ëŠ” source branchì˜ JpaMain.java ì°¸ê³ _
### ì‚½ì…
```java
Member member = new Member();
member.setId(2L);
member.setName("HelloB");
```
### ì¡°íšŒ
```java
Member findMember = em.find(Member.class, 1L);
System.out.println("findMember = " + findMember.getId());
System.out.println("findMember = " + findMember.getName());      
```
### ê°±ì‹ 
```java
findMember.setName("HelloJPA");
// em.persist í•˜ì§€ ì•Šì•„ë„ ë¨, ìë°” ì»¬ë™ì…˜ê³¼ ë¹„ìŠ·í•œ êµ¬ì¡°ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸.. ì™€ìš°
// JPAê°€ ë°ì´í„°ì˜ ë³€ê²½ ì—¬ë¶€ë¥¼ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹ ì‹œì ì—ì„œ ì²´í¬í•¨
```
### ì‚­ì œ
```java
em.remove(findMember);
```

## JPQLì´ë€?
- __ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ì•„ë‹Œ, ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê°œë°œí•¨__ (ë°ì´í„°ë² ì´ìŠ¤ì— ì¢…ì†ì ì´ì§€ ì•ŠìŒ) âœ¨
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•œ ë°ì´í„°ë§Œ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ê²°êµ­ ê²€ìƒ‰ ì¡°ê±´ì´ í¬í•¨ëœ SQLì´ í•„ìš”í•˜ê²Œ ë¨
  ```java
  List<Member> result = em.createQuery("select m from Member as m where name = 'HelloA'", Member.class)
           .setFirstResult(0) // í˜ì´ì§• ë‹¨ìœ„ ì„¤ì • ê°€ëŠ¥ (ì²« ì‹œì‘)
           .setMaxResults(10) // í˜ì´ì§• ë‹¨ìœ„ ì„¤ì • ê°€ëŠ¥ (ë§ˆì§€ë§‰)
           .getResultList();
   for (Member member : result) { // Iterator
       System.out.println("member.name = " + member.getName());
   }
  ```
- JPAëŠ” SQLì„ ì¶”ìƒí™”í•œ JPQLì´ë¼ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ ì œê³µ!
- SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN ì‚¬ìš© ê°€ëŠ¥

### ì–´ë…¸í…Œì´ì…˜ ì •ë¦¬
- ```@Entity``` : jpaë¥¼ ì‚¬ìš©í•œë‹¤ê³  ì¸ì‹í•˜ê²Œ í•¨. jpa ì‚¬ìš© ì‹œ í•„ìˆ˜!
- ```@Table``` : íŠ¹ì • í…Œì´ë¸”ì— ë™ì‘í•˜ë„ë¡ ëª…ì‹œ (ex. @Table(name = "USER"))
- ```@Id``` : ê¸°ë³¸í‚¤ ì§€ì •
- ```@Column``` : DBì˜ ì»¬ëŸ¼ëª…ì„ ëª…ì‹œ (ì†ŒìŠ¤ì— ëª…ì‹œëœ ì»¬ëŸ¼ëª…ê³¼ ë‹¤ë¥¼ ë•Œ í•˜ëŠ” ê²ƒ ê°™ìŒ)

- - - 
### ğŸ©¹ ì˜¤ë¥˜ ì²˜ë¦¬ â‘ 
- ì˜¤ë¥˜ : JpaMain.java ì‹¤í–‰ í›„ h2database ê´€ë ¨í•˜ì—¬ ```java.lang.ClassNotFoundException: javax.xml.bind.JAXBException``` ì˜¤ë¥˜ ë°œìƒ
- ì›ì¸ : Java 8 ë²„ì „ë³´ë‹¤ ë†’ì€ ë²„ì „ì˜ Javaë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆìŒ, ë²„ì „ì—… ì‹œ í•´ë‹¹ ëª¨ë“ˆì´ ì œê±°ë˜ì–´ ì¸ì‹ ë¶ˆê°€
- í•´ê²° : ```Maven > javax.xml.bind <dependency>``` ì¶”ê°€
- ì°¸ê³  ë‚´ìš© : [tistory] [java.lang.ClassNotFoundException: javax.xml.bind.JAXBException ì—ëŸ¬](https://yeonyeon.tistory.com/240)
- ì†ŒìŠ¤
  ```xml
  [pom.xml]
  
  <!--Java 8 ë²„ì „ ì´ìƒìœ¼ë¡œ ClassNotFoundExcpetion ì˜¤ë¥˜ ë°œìƒ, ì¶”ê°€í•¨-->
  <dependency>
      <groupId>javax.xml.bind</groupId>
      <artifactId>jaxb-api</artifactId>
      <version>2.3.0</version>
  </dependency>
  ```

### ğŸ©¹ ì˜¤ë¥˜ ì²˜ë¦¬ â‘¡
- ì˜¤ë¥˜ : JpaMain.java ì‹¤í–‰ í›„ ```Database "C:/Users/HA/test" not found, and IFEXISTS=true, so we cant auto-create it``` ì˜¤ë¥˜ ë°œìƒ
- ì›ì¸ : h2 ì½˜ì†” ë‚´ JDBC URLì„ ì˜¬ë°”ë¥´ê²Œ í‘œê¸°í•˜ì§€ ì•Šì•˜ìŒ
- í•´ê²°
  1. h2 database ë²„ì „ì„ 1.4.199 ë²„ì „ìœ¼ë¡œ ë³€ê²½
  2. h2.bat íŒŒì¼ ì‹¤í–‰ (windows)
  3. H2 ì½˜ì†”ì´ ë¸Œë¼ìš°ì €ì— ë„ì›Œì§€ë©´ JDBC URLì„ ì¬ì„¤ì •
     ```jdbc:h2:tcp:localhost/~/test``` ì™€ ê°™ì€ í˜•íƒœì—ì„œ ```jdbc:h2:~/test``` ë¡œ ë³€ê²½ í›„ ì—°ê²°
- ì°¸ê³  ë‚´ìš© : [stackoverflow] [Database not found, and IFEXISTS=true, so we cant auto-create it](https://stackoverflow.com/questions/55349373/database-not-found-and-ifexists-true-so-we-cant-auto-create-it)

### ğŸ©¹ ì˜¤ë¥˜ ì²˜ë¦¬ â‘¢
- ì˜¤ë¥˜ : JpaMain.java ì‹¤í–‰ í›„ h2database ê´€ë ¨í•˜ì—¬ localhost ì£¼ì†Œë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ì˜¤ë¥˜ ë°œìƒ
- ì›ì¸ : h2 ì½˜ì†” ì ‘ê·¼ ì‹œ URLì„ IPìƒíƒœë¡œ ì ‘ê·¼í•˜ê³  ìˆì—ˆìŒ
- í•´ê²° : h2 ì½˜ì†” ìµœì´ˆ í™”ë©´ì—ì„œ URLì˜ IPë¥¼ localhostë¡œ ë³€ê²½í•˜ì—¬ ì—°ê²°, ê·¸ í›„ JpaMain.java ì‹¤í–‰ ì‹œ ì •ìƒ ì‘ë™
